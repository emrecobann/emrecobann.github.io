<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Radiology Impression Rater</title>
  <meta name="description"
    content="Radiology impression evaluation tool - professional scoring system for blinded model outputs">
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#070914">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü©ª</text></svg>">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>
  <script src="app.js" defer></script>
</head>

<body>
  <div class="bg" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="grid"></div>
  </div>

  <header class="topbar">
    <div class="brand">
      <div class="mark" aria-hidden="true">
        <div class="mark-inner">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2L2 7l10 5 10-5-10-5z" />
            <path d="M2 17l10 5 10-5" />
            <path d="M2 12l10 5 10-5" />
          </svg>
        </div>
      </div>
      <div class="brand-text">
        <div class="title">Radiology Impression Rater</div>
        <div class="subtitle">Blinded Evaluation ‚Ä¢ Score 1-5 ‚Ä¢ Auto-save</div>
      </div>
    </div>

    <div class="topbar-right">
      <span id="userBadge" class="badge hidden">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
          <circle cx="12" cy="7" r="4" />
        </svg>
        <span id="userBadgeText"></span>
      </span>
    </div>
  </header>

  <main class="wrap">
    <!-- LOGIN -->
    <section id="screenLogin" class="card glass">
      <div class="card-head">
        <div class="card-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
            <polyline points="10 17 15 12 10 7" />
            <line x1="15" y1="12" x2="3" y2="12" />
          </svg>
        </div>
        <div>
          <h1>Start / Resume</h1>
          <p class="muted">Samples are seeded by <strong>UserID</strong>. Same user continues from where they left off.
          </p>
        </div>
      </div>

      <div class="field">
        <label class="label">Evaluation Mode</label>
        <div style="display:flex;gap:20px;margin-top:10px;">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="radio" name="evalMode" value="model" checked
              style="width:18px;height:18px;accent-color:#5a7bb5;" />
            <span>Model Output Evaluation</span>
          </label>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="radio" name="evalMode" value="hardness" style="width:18px;height:18px;accent-color:#5a7bb5;" />
            <span>Case Hardness Evaluation</span>
          </label>
        </div>
      </div>

      <div class="form-grid">
        <div class="field">
          <label class="label" for="userId">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
              <polyline points="22,6 12,13 2,6" />
            </svg>
            Email Address (required)
          </label>
          <input id="userId" class="input" type="email" placeholder="e.g. doctor@example.com" autocomplete="email"
            required />
          <div class="hint">‚ö†Ô∏è <strong>Important:</strong> Use the same email every time. Any email works, but stick to
            one to avoid losing your progress. Same email = same cases + saved ratings. Each dataset has 10 cases.</div>
        </div>
      </div>

      <details class="details" id="modelGuide" open>
        <summary>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="16" x2="12" y2="12" />
            <line x1="12" y1="8" x2="12.01" y2="8" />
          </svg>
          Model Evaluation Guide
        </summary>
        <ul>
          <li>Each dataset has <strong>10 cases</strong> to evaluate</li>
          <li><strong>Rate each model</strong> from 1 (poor) to 5 (excellent) based on:</li>
          <li style="margin-left:20px;">‚úì <strong>Correctness</strong> - Clinical accuracy and appropriateness</li>
          <li style="margin-left:20px;">‚úì <strong>Completeness</strong> - Comprehensive impression coverage</li>
          <li style="margin-left:20px;">‚úì <strong>Conciseness</strong> - Clear and to the point</li>
          <li style="margin-left:20px;">‚úì <strong>Format Quality</strong> - Professional structure</li>
          <li style="margin-left:20px;">‚úì <strong>Hallucination</strong> - Absence of fabricated information</li>
          <li>Model names are <strong>blinded</strong>: shown as A, B, C, D, E, F, G</li>
          <li>Model order is <strong>randomized</strong> per user to prevent bias</li>
        </ul>
      </details>

      <details class="details" id="hardnessGuide" style="display:none;">
        <summary>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="16" x2="12" y2="12" />
            <line x1="12" y1="8" x2="12.01" y2="8" />
          </svg>
          Hardness Evaluation Guide
        </summary>
        <ul>
          <li><strong>Task:</strong> Rate the reasoning complexity from Findings ‚Üí Impression</li>
          <li><strong>Hardness Levels (1-4):</strong></li>
          <li style="margin-left:20px;"><strong>1 - Trivial:</strong> Straightforward normal study OR single obvious
            finding, no ambiguity</li>
          <li style="margin-left:20px;"><strong>2 - Simple:</strong> Few simple findings with direct mapping to common
            impression</li>
          <li style="margin-left:20px;"><strong>3 - Moderate:</strong> Multiple findings OR mild ambiguity/negation
            requiring attention</li>
          <li style="margin-left:20px;"><strong>4 - Hard:</strong> Complex reasoning, multiple differentials, or nuanced
            wording</li>
          <li style="margin-left:20px;margin-top:8px;"><em>Note: Disease presence ‚â† hardness. Focus on reasoning
              complexity.</em></li>
          <li>Dataset: <strong>40 cases (10 per level), shuffled per user</strong></li>
        </ul>
      </details>

      <div class="actions">
        <button id="btnStart" class="btn primary" type="button">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
          Start / Resume
        </button>
      </div>


      <div id="loginStatus" class="status"></div>
    </section>

    <!-- APP -->
    <section id="screenApp" class="hidden">
      <div class="toolbar">
        <div class="tabs" id="datasetTabs" role="tablist"></div>

        <div class="toolbar-right">
          <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-label">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 11 12 14 22 4" />
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
              </svg>
              <span id="progressText">0/0</span>
            </div>
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill" style="width:0%"></div>
            </div>
          </div>
        </div>
      </div>

      <section id="caseCard" class="card" aria-live="polite"></section>

      <div class="actions sticky">
        <button id="btnPrev" class="btn ghost" type="button">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6" />
          </svg>
          Previous
        </button>
        <button id="btnSaveNext" class="btn primary" type="button">
          Save & Next
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6" />
          </svg>
        </button>
      </div>

      <div id="appStatus" class="status" role="status" aria-live="polite"></div>
    </section>

    <!-- HARDNESS EVALUATION SCREEN -->
    <section id="screenHardness" class="hidden">
      <div class="toolbar">
        <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
          style="flex:1;max-width:400px;">
          <div class="progress-label">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 11 12 14 22 4" />
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
            </svg>
            <span id="hardnessProgressText">0/0</span>
          </div>
          <div class="progress-bar">
            <div id="hardnessProgressFill" class="progress-fill" style="width:0%"></div>
          </div>
        </div>
      </div>

      <section id="hardnessCard" class="card" aria-live="polite"></section>

      <div class="actions sticky">
        <button id="btnHardnessPrev" class="btn ghost" type="button">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6" />
          </svg>
          Previous
        </button>
        <button id="btnHardnessSaveNext" class="btn primary" type="button">
          Save & Next
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6" />
          </svg>
        </button>
      </div>

      <div id="hardnessStatus" class="status" role="status" aria-live="polite"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <span class="footer-brand">Radiology Impression Rater</span>
      <span class="footer-sep">|</span>
      <span>Powered by Supabase & GitHub Pages</span>
    </div>
  </footer>
</body>

</html>